{"version":3,"file":"axios-business.cjs.js","sources":["../src/util.ts","../src/axiosext.ts","../main.ts"],"sourcesContent":["/**\n * 判断对象\n * @param o\n * @returns\n */\nexport function isObj(o: any) {\n  return Object.prototype.toString.call(o) === \"[object Object]\";\n}\n","import { AxiosExtConfig, AxiosExtInstance, FreeObject } from \"@type/index\";\nimport axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from \"axios\";\n\n/**\n * 错误处理\n * @param error\n * @returns\n */\nfunction rejectedHandler(error: any) {\n  return Promise.reject(error);\n}\n\n/**\n * 预处理AxiosRequestConfig\n * 处理rest API，将API中的参数替换为实际值\n *\n * @param config\n * @returns\n */\nfunction parseRestParam(config: AxiosRequestConfig) {\n  const { url = \"\", params = {}, data = {}, method } = config;\n\n  if (FormData && data instanceof FormData) {\n    return config;\n  }\n\n  const tmpParams = { ...params, ...data };\n  config.url = url.replace(/:([^/\\d]+)/g, (sub, $0) => {\n    const v = tmpParams[$0];\n    Reflect.deleteProperty(tmpParams, $0);\n    return v;\n  });\n\n  if (method === \"get\") {\n    config.params = { ...tmpParams };\n    config.data = {};\n  } else {\n    config.params = {};\n    config.data = { ...tmpParams };\n  }\n\n  return config;\n}\n\n/**\n * 预处理AxiosResponse\n *\n * @param response\n * @returns\n */\nfunction parseToJSON(response: AxiosResponse) {\n  const {\n    config: { responseType },\n    data,\n  } = response;\n\n  if (responseType === \"json\") {\n    return data;\n  }\n\n  return response;\n}\n\nlet ins: AxiosInstance | null = null;\n\n/**\n * 获取Axios实例\n * @param config\n * @returns\n */\nfunction getInstance(config: AxiosExtConfig) {\n  if (ins !== null) {\n    return ins;\n  }\n\n  const cfg: AxiosRequestConfig = {\n    baseURL: \"\",\n    timeout: config.timeout || 10000,\n    headers: { \"Content-Type\": \"application/json\" },\n    responseType: \"json\",\n  };\n\n  ins = axios.create(cfg);\n\n  return ins;\n}\n\n/**\n * 导出一个实例\n *\n * @param config\n * @returns\n */\nexport default function (config: AxiosExtConfig): AxiosExtInstance {\n  const instance = getInstance(config);\n\n  const before = config.interceptor?.request;\n  if (typeof before === \"function\") {\n    instance.interceptors.request.use(before, rejectedHandler);\n  }\n\n  const after = config.interceptor?.response;\n  if (typeof after === \"function\") {\n    instance.interceptors.response.use(after, rejectedHandler);\n  }\n\n  instance.interceptors.request.use(parseRestParam, rejectedHandler);\n  instance.interceptors.response.use(parseToJSON, rejectedHandler);\n\n  return {\n    instance: instance,\n    post: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.post(url, data, config);\n    },\n\n    delete: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.delete(url, { data, ...config });\n    },\n\n    put: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.put(url, data, config);\n    },\n\n    get: (url: string, params?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.get(url, { params, ...config });\n    },\n\n    patch: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.put(url, data, config);\n    },\n\n    blob: (url: string, params?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.get(url, {\n        params,\n        ...config,\n        responseType: \"blob\",\n      });\n    },\n  };\n}\n","import { isObj } from \"@src/util\";\nimport {\n  ApiFunc,\n  ApiModule,\n  AxiosExtConfig,\n  AxiosExtInstance,\n} from \"@type/index\";\nimport axiosext from \"./src/axiosext\";\n\nlet axiosExtInstance: null | AxiosExtInstance = null;\n\nfunction parseModule(apiModules: Record<string, ApiModule>) {\n  if (!isObj(apiModules)) return {};\n\n  const apis: ApiFunc = {};\n  Object.keys(apiModules).forEach((moduleName) => {\n    apis[moduleName] = {};\n\n    const module: ApiModule = apiModules[moduleName];\n    Object.keys(module).forEach((funcName) => {\n      const { url, method } = module[funcName];\n\n      const me = (method || \"\").toLowerCase();\n      const httpMethod = (axiosExtInstance as any)[me];\n\n      if (httpMethod) {\n        apis[moduleName][funcName] = httpMethod.bind(null, url);\n      }\n    });\n  });\n\n  return apis;\n}\n\nlet apis: null | ApiFunc = null;\nexport function createApis(config: AxiosExtConfig) {\n  if (apis !== null) {\n    return apis;\n  }\n\n  axiosExtInstance = axiosext(config);\n\n  apis = parseModule(config.modules);\n  return apis;\n}\n"],"names":["isObj","o","Object","prototype","toString","call","rejectedHandler","error","Promise","reject","parseRestParam","config","url","params","data","method","FormData","tmpParams","replace","sub","$0","v","Reflect","deleteProperty","parseToJSON","response","responseType","ins","getInstance","cfg","baseURL","timeout","headers","axios","create","instance","before","interceptor","request","interceptors","use","after","post","delete","put","get","patch","blob","axiosExtInstance","parseModule","apiModules","apis","keys","forEach","moduleName","module","funcName","me","toLowerCase","httpMethod","bind","createApis","axiosext","modules"],"mappings":"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"}