{"version":3,"file":"axios-ext.umd.js","sources":["../src/util.ts","../src/axiosext.ts","../main.ts"],"sourcesContent":["/**\n * 判断对象\n * @param o\n * @returns\n */\nexport function isObj(o: any) {\n  return Object.prototype.toString.call(o) === \"[object Object]\";\n}\n","import { AxiosExtConfig, AxiosExtInstance, FreeObject } from \"@type/index\";\nimport axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from \"axios\";\n\n/**\n * 错误处理\n * @param error\n * @returns\n */\nfunction rejectedHandler(error: any) {\n  return Promise.reject(error);\n}\n\n/**\n * 预处理AxiosRequestConfig\n * 处理rest API，将API中的参数替换为实际值\n *\n * @param config\n * @returns\n */\nfunction parseRestParam(config: AxiosRequestConfig) {\n  const { url = \"\", params = {}, data = {}, method } = config;\n\n  if (FormData && data instanceof FormData) {\n    return config;\n  }\n\n  const tmpParams = { ...params, ...data };\n  config.url = url.replace(/:([^/\\d]+)/g, (sub, $0) => {\n    const v = tmpParams[$0];\n    Reflect.deleteProperty(tmpParams, $0);\n    return v;\n  });\n\n  if (method === \"get\") {\n    config.params = { ...tmpParams };\n    config.data = {};\n  } else {\n    config.params = {};\n    config.data = { ...tmpParams };\n  }\n\n  return config;\n}\n\n/**\n * 预处理AxiosResponse\n *\n * @param response\n * @returns\n */\nfunction parseToJSON(response: AxiosResponse) {\n  const {\n    config: { responseType },\n    data,\n  } = response;\n\n  if (responseType === \"json\") {\n    return data;\n  }\n\n  return response;\n}\n\nlet ins: AxiosInstance | null = null;\n\n/**\n * 获取Axios实例\n * @param config\n * @returns\n */\nfunction getInstance(config: AxiosExtConfig) {\n  if (ins !== null) {\n    return ins;\n  }\n\n  const cfg: AxiosRequestConfig = {\n    baseURL: \"\",\n    timeout: config.timeout || 10000,\n    headers: { \"Content-Type\": \"application/json\" },\n    responseType: \"json\",\n  };\n\n  ins = axios.create(cfg);\n\n  return ins;\n}\n\n/**\n * 导出一个实例\n *\n * @param config\n * @returns\n */\nexport default function (config: AxiosExtConfig): AxiosExtInstance {\n  const instance = getInstance(config);\n\n  const before = config.interceptor?.request;\n  if (typeof before === \"function\") {\n    instance.interceptors.request.use(before, rejectedHandler);\n  }\n\n  const after = config.interceptor?.response;\n  if (typeof after === \"function\") {\n    instance.interceptors.response.use(after, rejectedHandler);\n  }\n\n  instance.interceptors.request.use(parseRestParam, rejectedHandler);\n  instance.interceptors.response.use(parseToJSON, rejectedHandler);\n\n  return {\n    instance: instance,\n    post: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.post(url, data, config);\n    },\n\n    delete: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.delete(url, { data, ...config });\n    },\n\n    put: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.put(url, data, config);\n    },\n\n    get: (url: string, params?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.get(url, { params, ...config });\n    },\n\n    patch: (url: string, data?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.put(url, data, config);\n    },\n\n    blob: (url: string, params?: FreeObject, config?: AxiosRequestConfig) => {\n      return instance.get(url, {\n        params,\n        ...config,\n        responseType: \"blob\",\n      });\n    },\n  };\n}\n","import { isObj } from \"@src/util\";\nimport {\n  ApiFunc,\n  ApiModule,\n  AxiosExtConfig,\n  AxiosExtInstance,\n} from \"@type/index\";\nimport axiosext from \"./src/axiosext\";\n\nlet axiosExtInstance: null | AxiosExtInstance = null;\n\nfunction parseModule(apiModules: Record<string, ApiModule>) {\n  if (!isObj(apiModules)) return {};\n\n  const apis: ApiFunc = {};\n  Object.keys(apiModules).forEach((moduleName) => {\n    apis[moduleName] = {};\n\n    const module: ApiModule = apiModules[moduleName];\n    Object.keys(module).forEach((funcName) => {\n      const { url, method } = module[funcName];\n\n      const me = (method || \"\").toLowerCase();\n      const httpMethod = (axiosExtInstance as any)[me];\n\n      if (httpMethod) {\n        apis[moduleName][funcName] = httpMethod.bind(null, url);\n      }\n    });\n  });\n\n  return apis;\n}\n\nlet apis: null | ApiFunc = null;\nexport function createApis(config: AxiosExtConfig) {\n  if (apis !== null) {\n    return apis;\n  }\n\n  axiosExtInstance = axiosext(config);\n\n  apis = parseModule(config.modules);\n  return apis;\n}\n"],"names":["isObj","o","Object","prototype","toString","call","rejectedHandler","error","Promise","reject","parseRestParam","config","url","params","data","method","FormData","tmpParams","replace","sub","$0","v","Reflect","deleteProperty","parseToJSON","response","responseType","ins","getInstance","cfg","baseURL","timeout","headers","axios","create","instance","before","interceptor","request","interceptors","use","after","post","delete","put","get","patch","blob","axiosExtInstance","parseModule","apiModules","apis","keys","forEach","moduleName","module","funcName","me","toLowerCase","httpMethod","bind","createApis","axiosext","modules"],"mappings":"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"}